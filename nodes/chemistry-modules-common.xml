<?xml version="1.0" standalone="no"?>

<kickstart>

<description>
Chemistry-related application codes module files
apbs http://www.poissonboltzmann.org/apbs
lammps http://lammps.sandia.gov
namd http://www.ks.uiuc.edu/Research/namd
gromacs http://www.gromacs.org
cp2k: http://cp2k.berlios.de
</description>

<copyright>
Copyright (c) 2000 - 2011 The Regents of the University of California.
All rights reserved. Rocks(r) v5.1 www.rocksclusters.org
</copyright>

<changelog>
</changelog>

<post>

# Remove /etc/profile.d files in favor of loadable modules when available

if test `grep -c /opt/modulefiles/applications /etc/profile.d/modules.csh` = 0; then
  echo 'setenv MODULEPATH /opt/modulefiles/applications:$MODULEPATH' >> \
       /etc/profile.d/modules.csh
fi
if test `grep -c /opt/modulefiles/applications /etc/profile.d/modules.sh` = 0; then
  echo 'export MODULEPATH=/opt/modulefiles/applications:$MODULEPATH' >> \
       /etc/profile.d/modules.sh
fi

<!-- APBS -->
if test -f /etc/profile.d/apbs.sh; then
  /bin/rm -f /etc/profile.d/apbs.*
/bin/mkdir -m 0755 -p /opt/modulefiles/applications/apbs
<file name="/opt/modulefiles/applications/apbs/1.3" perms="0644">
#%Module1.0
prepend-path PATH /opt/apbs/bin
</file>

<file name="/opt/modulefiles/applications/apbs/.version.1.3">
#%Module1.0
set ModulesVersion "1.3"
</file>

/bin/ln -s /opt/modulefiles/applications/apbs/.version.1.3 \
             /opt/modulefiles/applications/apbs/.version
fi

<!-- LAMMPS -->
if test -f /etc/profile.d/lammps.sh; then
  /bin/rm -f /etc/profile.d/lammps.*
/bin/mkdir -m 0755 -p /opt/modulefiles/applications/lammps
<file name="/opt/modulefiles/applications/lammps/18Feb11" perms="0644">
#%Module1.0
prepend-path PATH /opt/lammps/bin
</file>

<file name="/opt/modulefiles/applications/lammps/.version.18Feb11">
#%Module1.0
set ModulesVersion "18Feb11"
</file>

  /bin/ln -s /opt/modulefiles/applications/lammps/.version.18Feb11 \
             /opt/modulefiles/applications/lammps/.version
fi
<!-- NAMD -->
if test -f /etc/profile.d/namd.sh; then
  /bin/rm -f /etc/profile.d/namd.*
/bin/mkdir -m 0755 -p /opt/modulefiles/applications/namd
<file name="/opt/modulefiles/applications/namd/2.6" perms="0644">
#%Module1.0
prepend-path PATH /opt/namd/2.6/bin
</file>

<file name="/opt/modulefiles/applications/namd/.version.2.6">
#%Module1.0
set ModulesVersion "2.6"
</file>

<file name="/opt/modulefiles/applications/namd/2.8" perms="0644">
#%Module1.0
prepend-path PATH /opt/namd/2.8/bin
</file>

<file name="/opt/modulefiles/applications/namd/.version.2.8">
#%Module1.0
set ModulesVersion "2.8"
</file>

/bin/ln -s /opt/modulefiles/applications/namd/.version.2.8 \
             /opt/modulefiles/applications/namd/.version
fi
<!-- GROMACS -->
if test -f /etc/profile.d/gromacs.sh; then
  /bin/rm -f /etc/profile.d/gromacs.*
/bin/mkdir -m 0755 -p /opt/modulefiles/applications/gromacs
<file name="/opt/modulefiles/applications/gromacs/4.5.4" perms="0644">
#%Module1.0
setenv GMXBIN /opt/gromacs/bin
setenv GMXLDLIB=/opt/gromacs/lib
setenv GMXMAN=/opt/gromacs/share/man
setenv GMXDATA=/opt/gromacs/share
prepend-path PATH $GMXBIN
prepend-path LD_LIBRARY_PATH $GMXLDLIB
</file>

<file name="/opt/modulefiles/applications/namd/.version.4.5.4">
#%Module1.0
set ModulesVersion "4.5.4"
</file>

  /bin/ln -s /opt/modulefiles/applications/gromacs/.version.4.5.4 \
             /opt/modulefiles/applications/gromacs/.version

fi
<!-- CP2K -->
if test -f /etc/profile.d/cp2k.sh; then
  /bin/rm -f /etc/profile.d/cp2k.*
/bin/mkdir -m 0755 -p /opt/modulefiles/applications/cp2k

<file name="/opt/modulefiles/applications/cp2k/2.2.184" perms="0644">
#%Module1.0
prepend-path PATH /opt/cp2k/bin
</file>

<file name="/opt/modulefiles/applications/namd/.version.2.2.184">
#%Module1.0
set ModulesVersion "2.2.184"
</file>

  /bin/ln -s /opt/modulefiles/applications/cp2k/.version.2.2.184 \
             /opt/modulefiles/applications/cp2k/.version

fi
</post>

</kickstart>
